<html>
  <body>
     <h1>Create a simple test server</h1>
     <form id="form">
       <input type="text" id="hostname" value="ruby-worker" />
       <hr>
       <input type="text" id="user" value="plain:will" />
       <button type="button" data-type="perms_manager" data-string='{"perm": "mkgrantor"}'>grant: grantor</button>
       <button type="button" data-type="perms_manager" data-string='{"perm": "rmgrantor"}'>revoke: grantor</button>
       <button type="button" data-type="perms_worker" data-string='{"perm": "grantall"}'>grant: all</button>
       <button type="button" data-type="perms_worker" data-string='{"perm": "revokeall"}'>revoke: all</button>
       <hr>
       <input type="text" id="workerpool" value="_throwaway-500" />
       <button type="button" data-type="directive" data-string='{"dir": "mkpool"}'>mkpool</button>
       <button type="button" data-type="directive" data-string='{"dir": "spawn"}'>spawn</button>
       <button type="button" data-type="directive" data-string='{"dir": "remove"}'>remove</button>
       <hr>
       <input type="text" id="servername" value="test" />
       <button type="button" data-type="command" data-string='{"cmd": "get_external_profile",
"url": "https://launcher.mojang.com/v1/objects/b58b2ceb36e01bcd8dbf49c8fb66c55a9f0676cd/server.jar",
"group": "mojang",
"version": "1.8.9",
"dest_filename": "minecraft_server.1.8.9.jar" }'>get_prof</button>
       <hr>
       <button type="button" data-type="command" data-string='{"cmd": "create"}'>create</button>
       <button type="button" data-type="command" data-string='{"cmd": "modify_sc", "section": "java", "attr": "java_xmx", "value": 512}'>xmx</button>
       <button type="button" data-type="command" data-string='{"cmd": "modify_sc", "section": "java", "attr": "java_xms", "value": 512}'>xms</button>
       <button type="button" data-type="command" data-string='{"cmd": "modify_sc", "section": "java", "attr": "jarfile", "value": "minecraft_server.1.8.9.jar"}'>jarfile</button>
       <button type="button" data-type="command" data-string='{"cmd": "accept_eula"}'>eula</button>
       <button type="button" data-type="command" data-string='{"cmd": "receive_profile", "group": "mojang", "version": "1.8.9"}'>receive</button>
       <button type="button" data-type="command" data-string='{"cmd": "start"}'>start</button>
       <button type="button" data-type="command" data-string='{"cmd": "stop"}'>stop</button>
       <button type="button" data-type="command" data-string='{"cmd": "kill"}'>kill</button>
       <button type="button" data-type="command" data-string='{"cmd": "delete"}'>delete</button>
     </form>
     <div id="msgs"></div>
  </body>

  <script type="text/javascript">
    window.onload = function(){
      (function(){

        var ws       = new WebSocket('ws://' + window.location.host + window.location.pathname);
        ws.onopen    = function()  { console.log('websocket opened'); };
        ws.onclose   = function()  { console.log('websocket closed'); }
        ws.onmessage = function(m) { 
          payload = JSON.parse(m.data)
          if (payload['msg'] && payload['server_name']) {
            var div = document.getElementById('msgs');
            div.innerHTML += "[" + payload['server_name'] + "]-" + payload['msg'] + "<br>";
          }
          console.log("IN: %o", payload); 
        };

        var btns = document.querySelectorAll('button');
        for (var i = 0; i < btns.length; i++) {
          btns[i].addEventListener('click', function (event) {
            var payload = JSON.parse(this.getAttribute('data-string'));
            var type = this.getAttribute('data-type');
            if (type == 'directive') {
              payload['hostname'] = document.getElementById('hostname').value
              payload['workerpool'] = document.getElementById('workerpool').value
              console.log(payload);
              ws.send(JSON.stringify(payload));
            } else if (type == 'command') {
              payload['hostname'] = document.getElementById('hostname').value
              payload['workerpool'] = document.getElementById('workerpool').value
              payload['server_name'] = document.getElementById('servername').value
              console.log(payload);
              ws.send(JSON.stringify(payload));
            } else if (type == 'perms_manager') {
              payload['hostname'] = document.getElementById('hostname').value
              payload['user'] = document.getElementById('user').value
              console.log(payload);
              ws.send(JSON.stringify(payload));
            } else if (type == 'perms_worker') {
              payload['hostname'] = document.getElementById('hostname').value
              payload['workerpool'] = document.getElementById('workerpool').value
              payload['server_name'] = document.getElementById('servername').value
              payload['user'] = document.getElementById('user').value
              console.log(payload);
              ws.send(JSON.stringify(payload));
            }
          }, false);
        }

      })();
    }
  </script>
</html>
